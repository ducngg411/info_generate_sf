<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>US Info Generator Tool</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .info-card {
            margin-bottom: 32px;
            border: 1.5px solid #e3e6f0;
            border-radius: 14px;
            padding: 24px 20px 18px 20px;
            background: #fff;
            box-shadow: 0 2px 12px 0 rgba(0,0,0,0.04);
            transition: box-shadow 0.2s;
        }
        .info-card:hover {
            box-shadow: 0 4px 24px 0 rgba(0,0,0,0.10);
        }
        .info-card h5 {
            color: #0d6efd;
            margin-bottom: 18px;
            font-size: 1.3em;
            font-weight: 700;
            letter-spacing: 0.5px;
        }
        .info-item {
            margin-bottom: 8px;
            font-size: 1.04em;
            display: flex;
            flex-wrap: wrap;
            align-items: center;
        }
        .info-label {
            font-weight: 600;
            color: #495057;
            min-width: 140px;
            display: inline-block;
        }
        .verification-code {
            font-size: 1.2em;
            color: #198754;
            font-weight: bold;
        }
        .loading {
            display: none;
            margin: 20px 0;
        }
        .loading-spinner {
            width: 3rem;
            height: 3rem;
        }
        .progress-container {
            margin: 20px 0;
            display: none;
        }
        .progress-status {
            margin-top: 10px;
            font-size: 1.1em;
            color: #0d6efd;
        }
        .progress-error {
            color: #dc3545;
            margin-top: 5px;
        }
        .progress-success {
            color: #198754;
            margin-top: 5px;
        }
        .additional-section {
            background: #f8f9fa;
            border-radius: 10px;
            margin-top: 24px;
            padding: 18px 16px 12px 16px;
            box-shadow: 0 1px 6px 0 rgba(0,0,0,0.04);
        }
        .additional-section-title {
            font-weight: bold;
            color: #0d6efd;
            font-size: 1.08em;
            margin-bottom: 10px;
            letter-spacing: 0.2px;
        }
        .additional-row {
            display: flex;
            flex-wrap: wrap;
            gap: 18px;
        }
        .additional-col {
            flex: 1 1 180px;
            min-width: 140px;
            font-size: 1em;
            margin-bottom: 6px;
        }
        @media (max-width: 600px) {
            .info-card {
                padding: 14px 6px 10px 6px;
            }
            .info-label {
                min-width: 90px;
                font-size: 0.98em;
            }
            .additional-section {
                padding: 10px 6px 8px 6px;
            }
            .additional-row {
                gap: 8px;
            }
        }
    </style>
</head>
<body>
    <div class="container py-5">
        <h1 class="text-center mb-4">US Info Generator Tool</h1>
        
        <div class="row justify-content-center">
            <div class="col-md-8">
                <div class="card">
                    <div class="card-body">
                        <div class="mb-3">
                            <label for="count" class="form-label">Number of entries to generate:</label>
                            <input type="number" class="form-control" id="count" min="1" max="10" value="1">
                        </div>
                        <button class="btn btn-primary" onclick="generateInfo()">Generate Info</button>
                    </div>
                </div>

                <div class="loading text-center">
                    <div class="spinner-border loading-spinner text-primary" role="status">
                        <span class="visually-hidden">Loading...</span>
                    </div>
                    <p class="mt-2">Generating information...</p>
                </div>

                <div class="progress-container">
                    <div class="progress">
                        <div class="progress-bar progress-bar-striped progress-bar-animated" role="progressbar" style="width: 0%"></div>
                    </div>
                    <div class="progress-status"></div>
                    <div class="progress-error"></div>
                    <div class="progress-success"></div>
                </div>

                <div id="results"></div>
            </div>
        </div>
    </div>

    <script>
        let generatedInfo = [];

        async function generateInfo() {
            const count = document.getElementById('count').value;
            const resultsDiv = document.getElementById('results');
            const loadingDiv = document.querySelector('.loading');
            const progressContainer = document.querySelector('.progress-container');
            const progressBar = document.querySelector('.progress-bar');
            const progressStatus = document.querySelector('.progress-status');
            const progressError = document.querySelector('.progress-error');
            const progressSuccess = document.querySelector('.progress-success');
            
            try {
                loadingDiv.style.display = 'none';
                progressContainer.style.display = 'block';
                resultsDiv.innerHTML = '';
                progressBar.style.width = '0%';
                progressStatus.textContent = 'Starting...';
                progressError.textContent = '';
                progressSuccess.textContent = '';
                
                // Reset generatedInfo array
                generatedInfo = [];
                
                const response = await fetch('/api/generate-info', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ count: parseInt(count) })
                });

                const reader = response.body.getReader();
                const decoder = new TextDecoder();
                let buffer = '';

                while (true) {
                    const { value, done } = await reader.read();
                    if (done) break;
                    
                    buffer += decoder.decode(value, { stream: true });
                    const lines = buffer.split('\n');
                    buffer = lines.pop() || '';

                    for (const line of lines) {
                        if (!line.trim()) continue;
                        const data = JSON.parse(line);
                        
                        switch (data.type) {
                            case 'progress':
                                const progress = (data.current / data.total) * 100;
                                progressBar.style.width = `${progress}%`;
                                progressStatus.textContent = `${data.status} (${data.current}/${data.total})`;
                                if (data.data) {
                                    // Store the generated info
                                    generatedInfo.push(data.data);
                                    resultsDiv.appendChild(createInfoCard(data.data, data.current - 1));
                                }
                                break;
                            case 'error':
                                progressError.textContent = data.message;
                                break;
                            case 'complete':
                                progressSuccess.textContent = 'All accounts generated successfully!';
                                break;
                        }
                    }
                }
            } catch (error) {
                progressError.textContent = `Error: ${error.message}`;
            } finally {
                loadingDiv.style.display = 'none';
            }
        }

        function createInfoCard(info, index) {
            const card = document.createElement('div');
            card.className = 'info-card';
            card.innerHTML = `
                <h5>Info #${index + 1}</h5>
                <div class="info-item"><span class="info-label">Name:</span> ${info.firstName} ${info.lastName} ${info.suffix ? '(' + info.suffix + ')' : ''}</div>
                <div class="info-item"><span class="info-label">Pronoun:</span> ${info.pronoun || ''}</div>
                <div class="info-item"><span class="info-label">Email:</span> <span style="color:#0d6efd; font-weight:600;">${info.email}</span></div>
                <div class="info-item"><span class="info-label">Email Password:</span> <span style="color:#b35400;">${info.emailPassword}</span></div>
                <div class="info-item"><span class="info-label">Password:</span> <span style="color:#b35400;">${info.password}</span></div>
                <div class="info-item"><span class="info-label">Birth Date:</span> ${info.birthDate}</div>
                <div class="info-item"><span class="info-label">SSN:</span> <span style="letter-spacing:2px;">${info.ssn}</span></div>
                <div class="info-item"><span class="info-label">Country:</span> United States of America</div>
                <div class="info-item"><span class="info-label">Number & Street:</span> ${info.address}</div>
                <div class="info-item"><span class="info-label">Apartment:</span> ${info.apartment || ''}</div>
                <div class="info-item"><span class="info-label">City:</span> ${info.city}</div>
                <div class="info-item"><span class="info-label">State:</span> ${info.stateName} (${info.stateCode})</div>
                <div class="info-item"><span class="info-label">Zip Code:</span> ${info.zipCode}</div>
                <div class="info-item"><span class="info-label">Cell Phone:</span> <span style="color:#198754;">${info.phone}</span></div>
                <div class="mt-3 mb-2">
                    <button class="btn btn-success btn-sm" onclick="getCode(${index})">Get Verification Code</button>
                    <button class="btn btn-primary btn-sm ms-2" onclick="saveAccount(${index})">Save Info</button>
                </div>
                <div id="verification-${index}" class="mt-2"></div>
                ${info.additionalInfo ? `
                <div class="additional-section">
                    <div class="additional-section-title">Additional Info</div>
                    <div class="additional-row">
                        <div class="additional-col"><span class="info-label">First Name:</span> ${info.additionalInfo.firstName}</div>
                        <div class="additional-col"><span class="info-label">Last Name:</span> ${info.additionalInfo.lastName}</div>
                        <div class="additional-col"><span class="info-label">Email:</span> <span style="color:#198754;">${info.additionalInfo.email}</span></div>
                    </div>
                </div>
                ` : ''}
            `;
            return card;
        }

        async function getCode(index) {
            if (!generatedInfo[index]) {
                console.error('No info found for index:', index);
                return;
            }

            const info = generatedInfo[index];
            const verificationDiv = document.getElementById(`verification-${index}`);
            
            try {
                verificationDiv.innerHTML = '<div class="spinner-border spinner-border-sm text-primary" role="status"></div> Checking email...';
                
                const response = await fetch('/api/get-verification-code', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ 
                        email: info.email,
                        mailjs: info.mailjs
                    })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    verificationDiv.innerHTML = `
                        <div class="verification-code">
                            Verification Code: ${result.code}
                        </div>
                    `;
                } else {
                    verificationDiv.innerHTML = `
                        <div class="text-warning">
                            ${result.message || 'No verification code found'}
                        </div>
                    `;
                }
            } catch (error) {
                verificationDiv.innerHTML = `
                    <div class="text-danger">
                        Error: ${error.message}
                    </div>
                `;
            }
        }

        async function saveAccount(index) {
            if (!generatedInfo[index]) {
                console.error('No info found for index:', index);
                alert('Error: No account information found');
                return;
            }

            const info = generatedInfo[index];
            const sfId = prompt('Enter SF ID:');
            
            if (!sfId) return;
            
            try {
                const response = await fetch('/api/save-account', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        sfId,
                        info: {
                            firstName: info.firstName,
                            lastName: info.lastName,
                            email: info.email,
                            emailPassword: info.emailPassword,
                            password: info.password,
                            birthDate: info.birthDate,
                            ssn: info.ssn,
                            stateCode: info.stateCode,
                            stateName: info.stateName,
                            zipCode: info.zipCode,
                            address: info.address,
                            apartment: info.apartment,
                            city: info.city,
                            phone: info.phone,
                            pronoun: info.pronoun,
                            suffix: info.suffix,
                            additionalInfo: info.additionalInfo
                        }
                    })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    alert('Account saved successfully!');
                } else {
                    throw new Error(result.error || 'Failed to save account');
                }
            } catch (error) {
                alert('Error saving account: ' + error.message);
            }
        }
    </script>
</body>
</html> 